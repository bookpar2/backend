<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket 채팅 테스트 (DB 없이 메시지 전송만 확인)</title>
    <script>
        let userId = null;
        let chatroomId = 1;  // 고정된 채팅방 ID
        let websocket = null;
        const wsURL = "ws://52.79.55.92/ws/chat/";

        function selectUser(id) {
            userId = id;  // 사용자 ID 1 또는 2
            document.getElementById("user-selection").style.display = "none";
            document.getElementById("chatroom-container").style.display = "block";
            connectWebSocket();
        }

        function connectWebSocket() {
            websocket = new WebSocket(`${wsURL}${chatroomId}/`);
            websocket.onopen = () => console.log("WebSocket 연결 성공");
            websocket.onmessage = event => {
                const data = JSON.parse(event.data);
                const messageArea = document.getElementById("messages");
                messageArea.innerHTML += `<p><b>사용자 ${data.sender_id}:</b> ${data.message}</p>`;
            };
            websocket.onclose = () => console.log("WebSocket 연결 종료");
        }

        function sendMessage() {
            if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                alert("WebSocket이 연결되지 않았습니다.");
                return;
            }

            const messageInput = document.getElementById("message-input");
            const message = messageInput.value.trim();
            if (message === "") return;

            websocket.send(JSON.stringify({ sender_id: userId, message: message }));
            messageInput.value = "";
        }

        function disconnectChat() {
            if (websocket) {
                websocket.close();
            }
            document.getElementById("chatroom-container").style.display = "none";
            document.getElementById("user-selection").style.display = "block";
        }
    </script>
</head>
<body>

    <div id="user-selection">
        <h2>사용자 선택 (숫자 ID 사용)</h2>
        <button onclick="selectUser(1)">사용자 1</button>
        <button onclick="selectUser(2)">사용자 2</button>
    </div>

    <div id="chatroom-container" style="display: none;">
        <h2>채팅 테스트 (DB 저장 없이 WebSocket 메시지 테스트)</h2>
        <p>채팅방 ID: 1</p>
        <div id="messages" style="border: 1px solid black; height: 200px; overflow-y: scroll; padding: 5px;"></div>
        <input type="text" id="message-input" placeholder="메시지를 입력하세요">
        <button onclick="sendMessage()">전송</button>
        <button onclick="disconnectChat()">채팅 종료</button>
    </div>

</body>
</html>
